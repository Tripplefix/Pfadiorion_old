(function(a){a.fn.parallax=function(o){var f=a.extend({placeHolderName:".parallax",parallax:0.75},o);var k=new Array(),h=new Array(),l=0,c=a(window),b=document,j=a(".parallax"),d=a("body"),g=parseInt(c.width()),e=parseInt(c.height()),n=a(b.createElement("div"));n.addClass("parallax_parent");d.prepend(n);j.each(function(v,t){var s=a(t),q=parseInt(s.data("height")),p=parseInt(s.data("with")),u=s.data("image"),x=s.offset().top-c.scrollTop(),y=s.data("container-height");k[v]=0;h[v]=-s.data("posy");l=s.data("posy");a(f.placeHolderName).css({height:y,width:"100%"});if(g>=p){k[v]=0;p=p+(g-p);q=q*(g/p)}else{k[v]=(g-p)/2}var w=a(b.createElement("div"));w.addClass("parallax_container");w.css({visibility:"visible",height:y,transform:"translate3d(0px, "+x+"px, 0px)","-webkit-transform":"translate3d(0px, "+x+"px, 0px)"});var r=a(b.createElement("div"));r.addClass("parallax_image");r.css({backgroundImage:"url('"+u+"')",width:p,height:q,transform:"translate3d("+k[v]+"px, "+(-(x)*f.parallax-l)+"px, 0px)","-webkit-transform":"translate3d("+k[v]+"px, "+(-(x)*f.parallax-l)+"px, 0px)"});w.append(r);n.append(w)});var i=a(".parallax_container"),m=a(".parallax_image");c.resize(function(){g=parseInt(c.width());e=parseInt(c.height());m.each(function(r,t){var s=a(t),q=parseInt(a(j.get(r)).data("with")),p=parseInt(a(j.get(r)).data("height"));if(g>=q){k[r]=0;q=q+(g-q);p=p*(g/q)}else{k[r]=(g-q)/2}s.css({width:q,height:p,transform:"translate3d("+k[r]+"px, "+h[r]+"px, 0px)","-webkit-transform":"translate3d("+k[r]+"px, "+h[r]+"px, 0px)"})});i.each(function(p,r){var q=a(r);q.css({height:a(j[p]).data("container-height")})})});c.scroll(function(){var q=c.scrollTop(),p=e+q;i.css({visibility:"hidden",transform:"translate3d(0px, 0px, 0px)","-webkit-transform":"translate3d(0px, 0px, 0px)"});j.each(function(u,x){var v=a(x),y=v.offset().top,s=(y-q),t="visible",r=a(i.get(u)),w=v.data("container-height");if((p)>=y){if((q-y)>=w){s=0;t="hidden"}r.css({visibility:t,transform:"translate3d(0px, "+s+"px, 0px)","-webkit-transform":"translate3d(0px, "+s+"px, 0px)"});h[u]=(-(s)*f.parallax-l);r.children().first().css({transform:"translate3d("+k[u]+"px, "+h[u]+"px, 0px)","-webkit-transform":"translate3d("+k[u]+"px, "+h[u]+"px, 0px)"})}})});return this}}(jQuery));